<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch Audio Uploader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Light gray background */
        }

        /* Custom styles for the audio player */
        .audio-player-container {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
        }
        
        .upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.2s ease-in-out;
        }

        .upload-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            transition: background-color 0.2s;
        }

        .file-item:hover {
            background-color: #f3f4f6;
        }

        .play-button {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .play-button.playing {
            background-color: #ef4444; /* Red for recording/playing */
        }

        .play-button:not(.playing) {
            background-color: #3b82f6; /* Blue for paused */
        }
        
        .waveform-container {
            position: relative;
            flex-grow: 1;
            height: 60px;
            display: flex;
            align-items: center;
            margin: 0 1rem;
            overflow: hidden;
        }

        .waveform-progress {
            position: absolute;
            height: 100%;
            background-color: rgba(59, 130, 246, 0.4);
            z-index: 2;
        }

        .waveform-cursor {
            position: absolute;
            width: 2px;
            height: 100%;
            background-color: #1d4ed8;
            z-index: 3;
            left: 0;
        }

        .waveform-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="audio-player-container w-full max-w-4xl">
        <h1 class="text-2xl font-bold text-gray-800 mb-2">Audio Uploader</h1>
        <p class="text-gray-500 mb-6">Upload your audio files to see them in the list below.</p>
        
        <!-- File Upload Area -->
        <div id="upload-area" class="upload-area rounded-lg p-10 text-center cursor-pointer mb-6">
            <input type="file" id="file-input" class="hidden" multiple accept="audio/*">
            <div class="flex flex-col items-center">
                <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                <p class="mt-2 text-sm text-gray-600">
                    <span class="font-semibold">Click to upload</span> or drag and drop
                </p>
                <p class="text-xs text-gray-500">MP3, WAV, OGG, or any audio format</p>
            </div>
        </div>

        <!-- Audio File List -->
        <div id="file-list-container">
            <h2 class="text-lg font-semibold text-gray-700 mb-4" id="list-header" style="display: none;">Uploaded Files</h2>
            <div id="file-list" class="space-y-3">
                <!-- Audio file items will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const listHeader = document.getElementById('list-header');
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Trigger file input click when upload area is clicked
        uploadArea.addEventListener('click', () => fileInput.click());

        // Handle drag and drop events
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFiles(files);
            }
        });
        
        // Handle file selection from input
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            if (files.length > 0) {
                listHeader.style.display = 'block';
            }
            [...files].forEach(file => {
                if (file.type.startsWith('audio/')) {
                    createAudioPlayer(file);
                }
            });
        }
        
        // Function to format time from seconds to MM:SS.ss
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toFixed(2).padStart(5, '0')}`;
        }
        
        // Function to draw waveform on a canvas
        async function drawWaveform(file, canvas) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                const data = audioBuffer.getChannelData(0);
                const ctx = canvas.getContext('2d');

                // Set canvas display size and resolution
                const dpr = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                const width = canvas.clientWidth;
                const height = canvas.clientHeight;
                const middle = height / 2;

                ctx.clearRect(0, 0, width, height);
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#9ca3af'; // Waveform color
                ctx.beginPath();

                const samples = width; // One sample per pixel
                const chunkSize = Math.floor(data.length / samples);
                
                for (let i = 0; i < samples; i++) {
                    const chunkStart = i * chunkSize;
                    let min = 1.0;
                    let max = -1.0;
                    
                    for (let j = 0; j < chunkSize; j++) {
                        const sample = data[chunkStart + j];
                        if (sample < min) min = sample;
                        if (sample > max) max = sample;
                    }
                    
                    ctx.moveTo(i, middle + min * middle);
                    ctx.lineTo(i, middle + max * middle);
                }
                ctx.stroke();
            } catch (error) {
                console.error("Error drawing waveform:", error);
                // Optionally display an error on the canvas
                const ctx = canvas.getContext('2d');
                ctx.font = "12px Inter";
                ctx.fillStyle = "red";
                ctx.textAlign = "center";
                ctx.fillText("Could not draw waveform", canvas.clientWidth / 2, canvas.clientHeight / 2);
            }
        }


        function createAudioPlayer(file) {
            const fileId = `file-${Math.random().toString(36).substr(2, 9)}`;
            const fileUrl = URL.createObjectURL(file);
            const audio = new Audio(fileUrl);

            const playerItem = document.createElement('div');
            playerItem.className = 'file-item';
            playerItem.id = fileId;

            let duration = 0;

            audio.addEventListener('loadedmetadata', () => {
                duration = audio.duration;
                document.getElementById(`duration-${fileId}`).textContent = `/ ${formatTime(duration)}`;
            });

            playerItem.innerHTML = `
                <button class="play-button flex-shrink-0">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                    </svg>
                </button>
                <div class="waveform-container">
                    <canvas class="waveform-canvas"></canvas>
                    <div class="waveform-progress"></div>
                    <div class="waveform-cursor"></div>
                </div>
                <div class="flex items-center text-gray-600 text-sm font-mono flex-shrink-0">
                    <span id="current-time-${fileId}">00:00.00</span>
                    <span id="duration-${fileId}" class="ml-1">/ 00:00.00</span>
                </div>
                <button class="ml-4 text-gray-400 hover:text-red-500 transition-colors remove-btn">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg>
                </button>
            `;

            fileList.appendChild(playerItem);
            
            // Get the canvas and draw the waveform
            const canvas = playerItem.querySelector('.waveform-canvas');
            drawWaveform(file, canvas);

            const playButton = playerItem.querySelector('.play-button');
            const currentTimeEl = playerItem.querySelector(`#current-time-${fileId}`);
            const progressEl = playerItem.querySelector('.waveform-progress');
            const cursorEl = playerItem.querySelector('.waveform-cursor');
            const removeBtn = playerItem.querySelector('.remove-btn');

            playButton.addEventListener('click', () => {
                const isPlaying = playButton.classList.contains('playing');
                if (isPlaying) {
                    audio.pause();
                    playButton.classList.remove('playing');
                    playButton.innerHTML = `
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                        </svg>`;
                } else {
                    audio.play();
                    playButton.classList.add('playing');
                    playButton.innerHTML = `
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"></path>
                        </svg>`;
                }
            });

            audio.addEventListener('timeupdate', () => {
                if (duration > 0) {
                    const progressPercent = (audio.currentTime / duration) * 100;
                    currentTimeEl.textContent = formatTime(audio.currentTime);
                    progressEl.style.width = `${progressPercent}%`;
                    cursorEl.style.left = `${progressPercent}%`;
                }
            });

            audio.addEventListener('ended', () => {
                playButton.classList.remove('playing');
                playButton.innerHTML = `
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                    </svg>`;
                progressEl.style.width = '0%';
                cursorEl.style.left = `0%`;
                currentTimeEl.textContent = formatTime(0);
            });
            
            removeBtn.addEventListener('click', () => {
                audio.pause();
                URL.revokeObjectURL(fileUrl);
                playerItem.remove();
                 if (fileList.children.length === 0) {
                    listHeader.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>

