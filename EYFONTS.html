<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Text Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        
        @font-face {
            font-family: 'Sassoon Infant';
            src: url('https://cdn.jsdelivr.net/gh/boobalootoo/things/EYFONTS/SassoonInfantStd.otf') format('opentype');
        }

        @font-face {
            font-family: 'Sassoon Infant Dots';
            src: url('https://cdn.jsdelivr.net/gh/boobalootoo/things/EYFONTS/SassoonInfantStddots.otf') format('opentype');
        }

        @font-face {
            font-family: 'Gap Font';
            src: url('https://cdn.jsdelivr.net/gh/boobalootoo/things/EYFONTS/gapfont.otf') format('opentype');
        }

        @font-face {
            font-family: 'Gap Arrow Font';
            src: url('https://cdn.jsdelivr.net/gh/boobalootoo/things/EYFONTS/gapsarrowfont.otf') format('opentype');
        }

        body {
            font-family: 'Sassoon Infant', sans-serif;
        }

        #printable-area {
            width: 210mm;
            height: 297mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .text-container {
            position: absolute;
            cursor: move;
            border: 2px dashed transparent;
            min-width: 50px;
            min-height: 30px;
            box-sizing: border-box;
        }

        /* Style for the selected text box */
        .text-container.selected {
            border-color: #3b82f6; /* blue-500 */
            border-style: solid;
        }
        
        .text-container:not(.selected):hover {
             border-color: #93c5fd; /* blue-300 */
        }

        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #3b82f6;
            border: 2px solid white;
            border-radius: 50%;
            display: none;
            z-index: 10;
        }
        
        .text-container.selected .resize-handle {
            display: block;
        }

        .resize-handle.tl { top: -7px; left: -7px; cursor: nwse-resize; }
        .resize-handle.tr { top: -7px; right: -7px; cursor: nesw-resize; }
        .resize-handle.bl { bottom: -7px; left: -7px; cursor: nesw-resize; }
        .resize-handle.br { bottom: -7px; right: -7px; cursor: nwse-resize; }

        .text-container svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .text-container text {
            user-select: none;
        }
        
        /* On-canvas toolbar for selected items */
        .edit-toolbar {
            position: absolute;
            top: -32px;
            left: 0;
            display: none;
            gap: 4px;
            z-index: 20;
        }

        .text-container.selected .edit-toolbar {
            display: flex;
        }

        .toolbar-btn {
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .toolbar-btn:hover { background: #f0f0f0; }

        .color-palette {
            position: absolute;
            top: 32px;
            left: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .color-palette label {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }
        .color-palette input[type="color"] {
            width: 24px;
            height: 24px;
            border: none;
            padding: 0;
            background: none;
        }


        @media print {
            body * { visibility: hidden; }
            #printable-area, #printable-area * { visibility: visible; }
            #printable-area {
                position: absolute;
                left: 0; top: 0;
                width: 100%; height: 100%;
                margin: 0; padding: 0;
                box-shadow: none; border: none;
            }
            .text-container.selected, .text-container:hover { border-color: transparent !important; }
            .resize-handle, .edit-toolbar { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4 space-y-4">

    <!-- Editor View -->
    <div id="editor-view" class="w-full max-w-4xl bg-white p-6 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-4 text-gray-700">Text Editor</h1>
        
        <!-- Toolbar -->
        <div class="flex flex-wrap gap-x-6 gap-y-4 items-end border-b pb-4 mb-4">
            <!-- Font Style -->
            <fieldset class="p-0 m-0 border-0">
                 <legend class="text-sm font-medium text-gray-600 mb-1">Font Style</legend>
                 <div class="flex items-center gap-4">
                     <select id="font-family" class="p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none">
                         <option value="Sassoon Infant">Sassoon Infant</option>
                         <option value="Sassoon Infant Dots">Sassoon Infant Dots</option>
                         <option value="Gap Font">Gap Font</option>
                         <option value="Gap Arrow Font">Gap Arrow Font</option>
                     </select>
                     <input type="number" id="font-size" value="48" class="p-2 border rounded-md w-20 focus:ring-2 focus:ring-blue-500 focus:outline-none" title="Font Size">
                      <div class="flex items-center space-x-2">
                          <button id="font-bold" class="px-3 py-2 border rounded-md" title="Bold"><b>B</b></button>
                          <button id="font-italic" class="px-3 py-2 border rounded-md" title="Italic"><i>I</i></button>
                          <button id="font-underline" class="px-3 py-2 border rounded-md" title="Underline"><u>U</u></button>
                      </div>
                     <input type="color" id="font-color" value="#000000" class="w-12 h-10 border-0 rounded-md cursor-pointer" title="Font Color">
                 </div>
            </fieldset>
            
            <!-- Text Box Options -->
            <fieldset class="p-0 m-0 border-0">
                 <legend class="text-sm font-medium text-gray-600 mb-1">Text Box Options</legend>
                 <div class="flex items-center gap-4">
                     <input type="color" id="box-bg-color" value="#ffffff" class="w-12 h-10 border-0 rounded-md cursor-pointer" title="Background Color">
                     <input type="color" id="box-border-color" value="#000000" class="w-12 h-10 border-0 rounded-md cursor-pointer" title="Border Color">
                     <input type="number" id="box-border-width" value="0" min="0" class="p-2 border rounded-md w-20 focus:ring-2 focus:ring-blue-500 focus:outline-none" title="Border Width (px)">
                     <input type="number" id="box-padding" value="10" min="0" class="p-2 border rounded-md w-20 focus:ring-2 focus:ring-blue-500 focus:outline-none" title="Padding (px)">
                 </div>
            </fieldset>
        </div>

        <!-- Text Area -->
        <textarea id="text-input" rows="8" class="w-full p-4 border rounded-md text-base focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Type your text here..."></textarea>
    </div>
    
    <!-- Action Buttons -->
    <div id="action-buttons" class="flex space-x-4">
         <button id="add-text-box-btn" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
             Add Text Box to Canvas
         </button>
        <button id="print-btn" class="px-6 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75">
            Print
        </button>
    </div>

    <!-- Preview View -->
    <div id="preview-view" class="my-4">
        <div id="printable-area" class="bg-white mx-auto">
            <!-- Text containers will be added here dynamically -->
        </div>
    </div>

    <script>
        const textInput = document.getElementById('text-input');
        const fontFamilySelect = document.getElementById('font-family');
        const fontSizeInput = document.getElementById('font-size');
        const fontBoldBtn = document.getElementById('font-bold');
        const fontItalicBtn = document.getElementById('font-italic');
        const fontUnderlineBtn = document.getElementById('font-underline');
        const fontColorInput = document.getElementById('font-color');
        const addTextBoxBtn = document.getElementById('add-text-box-btn');
        const printBtn = document.getElementById('print-btn');
        const printableArea = document.getElementById('printable-area');

        const boxBgColorInput = document.getElementById('box-bg-color');
        const boxBorderColorInput = document.getElementById('box-border-color');
        const boxBorderWidthInput = document.getElementById('box-border-width');
        const boxPaddingInput = document.getElementById('box-padding');
        
        let isBold = false;
        let isItalic = false;
        let isUnderline = false;
        
        function updateTextAreaStyle() {
            textInput.style.fontFamily = fontFamilySelect.value;
            textInput.style.fontSize = `${fontSizeInput.value}px`;
            textInput.style.fontWeight = isBold ? 'bold' : 'normal';
            textInput.style.fontStyle = isItalic ? 'italic' : 'normal';
            textInput.style.textDecoration = isUnderline ? 'underline' : 'none';
            textInput.style.color = fontColorInput.value;
        }

        fontFamilySelect.addEventListener('change', updateTextAreaStyle);
        fontSizeInput.addEventListener('input', updateTextAreaStyle);
        fontColorInput.addEventListener('input', updateTextAreaStyle);

        fontBoldBtn.addEventListener('click', () => {
            isBold = !isBold; fontBoldBtn.classList.toggle('bg-blue-200'); updateTextAreaStyle();
        });
        fontItalicBtn.addEventListener('click', () => {
            isItalic = !isItalic; fontItalicBtn.classList.toggle('bg-blue-200'); updateTextAreaStyle();
        });
        fontUnderlineBtn.addEventListener('click', () => {
            isUnderline = !isUnderline; fontUnderlineBtn.classList.toggle('bg-blue-200'); updateTextAreaStyle();
        });

        addTextBoxBtn.addEventListener('click', () => {
            if (textInput.value.trim() === '') return;
            createTextContainer();
        });

        printBtn.addEventListener('click', () => window.print());

        function createTextContainer() {
            const container = document.createElement('div');
            container.className = 'text-container';
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            const textEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            
            textEl.textContent = textInput.value;
            textEl.setAttribute('x', '0');
            textEl.setAttribute('y', '0');
            textEl.setAttribute('dominant-baseline', 'hanging');
            textEl.style.fontFamily = fontFamilySelect.value;
            textEl.style.fontSize = `${fontSizeInput.value}px`;
            textEl.style.fontWeight = isBold ? 'bold' : 'normal';
            textEl.style.fontStyle = isItalic ? 'italic' : 'normal';
            textEl.style.textDecoration = isUnderline ? 'underline' : 'none';
            textEl.style.fill = fontColorInput.value;

            svg.appendChild(textEl);
            container.appendChild(svg);
            printableArea.appendChild(container);
            
            const bbox = textEl.getBBox();
            const padding = parseInt(boxPaddingInput.value, 10) || 0;
            const borderWidth = parseInt(boxBorderWidthInput.value, 10) || 0;
            container.style.backgroundColor = boxBgColorInput.value;
            container.style.padding = `${padding}px`;
            if (borderWidth > 0) {
                container.style.border = `${borderWidth}px solid ${boxBorderColorInput.value}`;
            }

            container.style.width = `${bbox.width + (padding * 2)}px`;
            container.style.height = `${bbox.height + (padding * 2)}px`;
            svg.setAttribute('viewBox', `0 0 ${bbox.width} ${bbox.height}`);
            container.style.top = '50px';
            container.style.left = '50px';
            
            createEditingHandles(container);
            makeInteractive(container);
            handleSelection(container); // Select the new box
        }

        function createEditingHandles(container) {
            // On-canvas toolbar
            const toolbar = document.createElement('div');
            toolbar.className = 'edit-toolbar';
            
            // Delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'toolbar-btn';
            deleteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg>`;
            deleteBtn.onclick = () => container.remove();
            
            // Color palette button
            const colorBtn = document.createElement('button');
            colorBtn.className = 'toolbar-btn';
            colorBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3M4 8a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m.5 4.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m3-1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m4.5-1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3M13 3.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/><path d="M16 8c0 3.15-1.866 5.84-4.5 7.16a.5.5 0 0 1-.447-.894A6.5 6.5 0 0 0 14.5 8a.5.5 0 0 1 1 0m-8.5 7.16A7.5 7.5 0 0 1 0 8a.5.5 0 0 1 1 0 6.5 6.5 0 0 0 11.053 4.26a.5.5 0 1 1-.447.894A7.5 7.5 0 0 1 7.5 15.16"/></svg>`;

            const palette = document.createElement('div');
            palette.className = 'color-palette';
            palette.style.display = 'none';
            palette.innerHTML = `
                <label>Font <input type="color" class="font-color-picker"></label>
                <label>BG <input type="color" class="bg-color-picker"></label>
            `;
            colorBtn.onclick = (e) => {
                e.stopPropagation();
                palette.style.display = palette.style.display === 'none' ? 'flex' : 'none';
            };
            
            const textEl = container.querySelector('text');
            const fontColorPicker = palette.querySelector('.font-color-picker');
            fontColorPicker.value = textEl.style.fill || '#000000';
            fontColorPicker.oninput = (e) => textEl.style.fill = e.target.value;

            const bgColorPicker = palette.querySelector('.bg-color-picker');
            bgColorPicker.value = container.style.backgroundColor || '#ffffff';
            bgColorPicker.oninput = (e) => container.style.backgroundColor = e.target.value;

            toolbar.appendChild(colorBtn);
            toolbar.appendChild(palette);
            // Delete button should be on the right
            deleteBtn.style.marginLeft = 'auto'; 
            toolbar.appendChild(deleteBtn);

            container.appendChild(toolbar);

            // Resize handles
            ['tl', 'tr', 'bl', 'br'].forEach(pos => {
                const handle = document.createElement('div');
                handle.className = `resize-handle ${pos}`;
                container.appendChild(handle);
            });
        }
        
        function handleSelection(targetElement) {
            document.querySelectorAll('.text-container').forEach(el => {
                el.classList.remove('selected');
                const palette = el.querySelector('.color-palette');
                if (palette) palette.style.display = 'none';
            });
            targetElement.classList.add('selected');
        }

        printableArea.addEventListener('click', (e) => {
            if (e.target === printableArea) {
                 document.querySelectorAll('.text-container').forEach(el => {
                     el.classList.remove('selected');
                     const palette = el.querySelector('.color-palette');
                     if (palette) palette.style.display = 'none';
                 });
            }
        });

        function makeInteractive(element) {
            let pos = { top: 0, left: 0, x: 0, y: 0 };
            let size = { w: 0, h: 0, x: 0, y: 0, l: 0, t: 0 };
            
            function dragMouseDown(e) {
                if (e.target.closest('.toolbar-btn')) return; // Don't drag if clicking a button
                e.preventDefault();
                handleSelection(element);
                pos.x = e.clientX;
                pos.y = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e.preventDefault();
                pos.top = e.clientY - pos.y;
                pos.left = e.clientX - pos.x;
                pos.y = e.clientY;
                pos.x = e.clientX;
                element.style.top = `${element.offsetTop + pos.top}px`;
                element.style.left = `${element.offsetLeft + pos.left}px`;
            }

            function closeDragElement() {
                document.onmouseup = null; document.onmousemove = null;
            }
            
            element.addEventListener('mousedown', dragMouseDown);

            function resizeMouseDown(e) {
                e.preventDefault();
                e.stopPropagation();
                handleSelection(element);
                size.x = e.clientX;
                size.y = e.clientY;
                const rect = element.getBoundingClientRect();
                size.w = element.offsetWidth; // Use offsetWidth for accuracy
                size.h = element.offsetHeight;
                size.l = element.offsetLeft;
                size.t = element.offsetTop;
                
                const handleType = e.target.classList.contains('tl') ? 'tl'
                                 : e.target.classList.contains('tr') ? 'tr'
                                 : e.target.classList.contains('bl') ? 'bl'
                                 : 'br';

                document.onmousemove = (event) => elementResize(event, handleType);
                document.onmouseup = closeResizeElement;
            }

            function elementResize(e, handleType) {
                const dx = e.clientX - size.x;
                const dy = e.clientY - size.y;

                let newWidth = size.w;
                let newHeight = size.h;
                let newLeft = size.l;
                let newTop = size.t;

                if (handleType.includes('r')) newWidth = size.w + dx;
                if (handleType.includes('l')) {
                    newWidth = size.w - dx;
                    newLeft = size.l + dx;
                }
                if (handleType.includes('b')) newHeight = size.h + dy;
                if (handleType.includes('t')) {
                    newHeight = size.h - dy;
                    newTop = size.t + dy;
                }
                
                if(newWidth > 20) {
                    element.style.width = `${newWidth}px`;
                    element.style.left = `${newLeft}px`;
                }
                if(newHeight > 20) {
                    element.style.height = `${newHeight}px`;
                    element.style.top = `${newTop}px`;
                }
            }

            function closeResizeElement() {
                document.onmousemove = null; document.onmouseup = null;
            }
            
            element.querySelectorAll('.resize-handle').forEach(handle => {
                handle.addEventListener('mousedown', resizeMouseDown);
            });
        }

        updateTextAreaStyle();
    </script>
</body>
</html>
